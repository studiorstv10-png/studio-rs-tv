<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ brand.name or 'Studio RS TV' }} — Painel</title>
    <style>
      :root {
        --brand: {{ brand.primary_color|default('#0d1b2a') }};
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: #0b0e11;
        color: #e9eef5;
      }
      header {
        background: var(--brand);
        padding: 16px 20px;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      header img.logo {
        height: 36px;
        width: auto;
        display: block;
      }
      header .title {
        font-size: 18px;
        font-weight: 600;
        line-height: 1.1;
      }
      main { padding: 20px; max-width: 1100px; margin: 0 auto; }
      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 16px;
      }
      .card {
        grid-column: span 12;
        background: #11161c;
        border: 1px solid #1b2530;
        border-radius: 12px;
        padding: 16px;
      }
      @media (min-width: 900px) {
        .card.col-6 { grid-column: span 6; }
        .card.col-4 { grid-column: span 4; }
        .card.col-8 { grid-column: span 8; }
      }
      .card h2 {
        margin: 0 0 10px 0;
        font-size: 16px;
        font-weight: 700;
      }
      label { display: block; font-size: 13px; margin: 10px 0 6px; color: #9fb3c8; }
      input[type="text"], input[type="url"], select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #293341;
        background: #0e141a;
        color: #e9eef5;
        outline: none;
      }
      input::placeholder { color: #6e8297; }
      .row { display: flex; gap: 12px; }
      .row > div { flex: 1; }
      .btn {
        display: inline-block;
        margin-top: 12px;
        padding: 10px 14px;
        border-radius: 8px;
        text-decoration: none;
        border: 1px solid #2a3645;
        background: #0e141a;
        color: #e9eef5;
        cursor: pointer;
      }
      .btn.primary { background: var(--brand); border-color: transparent; }
      .muted { color: #8ea4ba; font-size: 13px; }
      footer {
        margin-top: 24px;
        padding: 16px 20px;
        border-top: 1px solid #1b2530;
        text-align: center;
        color: #9fb3c8;
        font-size: 13px;
      }
      footer a { color: #b9d6ff; text-decoration: none; }
      footer a:hover { text-decoration: underline; }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        background: #0e141a;
        border: 1px solid #293341;
        border-radius: 999px;
        font-size: 12px;
        color: #b5c7da;
      }
    </style>
  </head>
  <body>
    <header>
      <img class="logo" src="{{ brand.logo }}" alt="{{ brand.name }}" onerror="this.style.display='none'">
      <div class="title">{{ brand.name }} — Painel</div>
      <div style="margin-left:auto">
        <span class="pill" title="Cor principal aplicada por CSS">Tema ativo</span>
      </div>
    </header>

    <main>
      <div class="grid">
        <div class="card col-6">
          <h2>Terminais</h2>
          <div class="row">
            <div>
              <label>Nome do Terminal</label>
              <input id="tname" type="text" placeholder="Ex.: BOX-001" />
            </div>
            <div>
              <label>Código (opcional)</label>
              <input id="tcode" type="text" placeholder="Ex.: 12345678" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Cliente</label>
              <input id="client" type="text" placeholder="Ex.: Mercado São José" />
            </div>
            <div>
              <label>Grupo</label>
              <input id="group" type="text" placeholder="Ex.: Açougue, Bebidas..." />
            </div>
          </div>
          <button class="btn primary" onclick="fakeSaveTerminal()">Criar / Atualizar</button>
          <div class="muted" id="terminalStatus" style="margin-top:8px"></div>
        </div>

        <div class="card col-6">
          <h2>Playlist (link simples p/ teste)</h2>
          <label>URL da Playlist (JSON/MP4/M3U)</label>
          <input id="plist" type="url" placeholder="https://exemplo.com/playlist.json" />
          <button class="btn" onclick="testConfig()">Enviar p/ Player (teste)</button>
          <div class="muted" id="configStatus" style="margin-top:8px"></div>
        </div>

        <div class="card col-12">
          <h2>Diagnóstico</h2>
          <div class="row">
            <div>
              <label>Ping</label>
              <button class="btn" onclick="doPing()">/api/v1/ping</button>
            </div>
            <div>
              <label>Config</label>
              <button class="btn" onclick="doConfig()">/api/v1/config?code=DEMO</button>
            </div>
          </div>
          <pre id="diag" class="muted" style="margin-top:10px; white-space:pre-wrap"></pre>
        </div>
      </div>
    </main>

    <footer>
      Desenvolvido por: <strong>Studio RS Ilhabela</strong> —
      <a href="{{ brand.support_wa }}" target="_blank" rel="noopener">Abrir suporte no WhatsApp</a>
    </footer>

    <script>
      async function doPing() {
        const el = document.getElementById('diag');
        el.textContent = 'Carregando...';
        try {
          const r = await fetch('/api/v1/ping');
          el.textContent = JSON.stringify(await r.json(), null, 2);
        } catch (e) {
          el.textContent = 'Erro: ' + e;
        }
      }
      async function doConfig() {
        const el = document.getElementById('diag');
        el.textContent = 'Carregando...';
        try {
          const r = await fetch('/api/v1/config?code=DEMO');
          el.textContent = JSON.stringify(await r.json(), null, 2);
        } catch (e) {
          el.textContent = 'Erro: ' + e;
        }
      }
      function fakeSaveTerminal() {
        const s = document.getElementById('terminalStatus');
        const name = document.getElementById('tname').value.trim();
        const code = document.getElementById('tcode').value.trim();
        const client = document.getElementById('client').value.trim();
        const group = document.getElementById('group').value.trim();
        if (!name) { s.textContent = 'Informe o nome do terminal.'; return; }
        s.textContent = `Terminal salvo (simulado): ${name} — cliente ${client || 'N/D'} — grupo ${group || 'N/D'} — código ${code || 'auto'}.`;
      }
      async function testConfig() {
        const el = document.getElementById('configStatus');
        const url = document.getElementById('plist').value.trim();
        if (!url) { el.textContent = 'Informe a URL da playlist.'; return; }
        try {
          const r = await fetch(`/api/v1/config?code=DEMO&playlist=${encodeURIComponent(url)}`);
          const j = await r.json();
          el.textContent = 'Config enviada (simulado).';
          const diag = document.getElementById('diag');
          diag.textContent = JSON.stringify(j, null, 2);
        } catch (e) {
          el.textContent = 'Erro: ' + e;
        }
      }
    </script>
  </body>
</html>
